<project name="codeqa-tasks" default="">
	<!-- Sets the needs.code.analysis.tools property if the code-analysis directory is not present -->
	<condition property="needs.code.analysis.tools">
		<not>
			<available type="dir" file="${code-analysis.dir}" />
		</not>
	</condition>

	<!-- Imports tools for running tests and code analyses from the codeqa project -->
	<target name="import.code.analysis.tools" if="needs.code.analysis.tools">
		<delete dir="${code-analysis.dir}" />
		<mkdir dir="${code-analysis.dir}" />
		<svn username="${svn.build.user}" password="${svn.build.passwd}" svnkit="true">
			<checkout url="http://compbio.ucdenver.edu/svn/ccp/codeqa/trunk" revision="HEAD" destPath="${code-analysis.dir}" />
		</svn>
	</target>

	<target name="run.unit.tests">
		<antcall target="call.code.test.target">
			<param name="target.name" value="test.unit" />
		</antcall>
	</target>

	<target name="run.functional.tests">
		<antcall target="call.code.test.target">
			<param name="target.name" value="test.fn" />
		</antcall>
	</target>

	<target name="compute.test.coverage">
		<antcall target="call.code.analysis.target">
			<param name="target.name" value="run.coverage.analysis" />
		</antcall>
	</target>

	<target name="run.findbugs">
		<antcall target="call.code.analysis.target">
			<param name="target.name" value="run.findbugs.analysis" />
		</antcall>
	</target>

	<target name="run.checkstyle">
		<antcall target="call.code.analysis.target">
			<param name="target.name" value="run.checkstyle.analysis" />
		</antcall>
	</target>

	<target name="run.pmd">
		<antcall target="call.code.analysis.target">
			<param name="target.name" value="run.pmd.analysis" />
		</antcall>
	</target>

	<target name="run.duplicate.code.finder">
		<antcall target="call.code.analysis.target">
			<param name="target.name" value="run.duplicate.code.analysis" />
		</antcall>
	</target>

	<target name="run.full.analysis">
		<antcall target="call.code.analysis.target">
					<param name="target.name" value="run.full.analysis" />
				</antcall>
	</target>
	
	<target name="call.code.analysis.target" depends="init, package-project, import.code.analysis.tools">
		<ant antfile="${code-analysis.dir}/ant/analyze.xml" inheritall="true" inheritrefs="true" target="${target.name}" />
		<antcall target="cleanup-postbuild" />
	</target>

	<target name="call.code.test.target" depends="init, package-project, import.code.analysis.tools">
		<ant antfile="${code-analysis.dir}/ant/testing.xml" inheritall="true" inheritrefs="true" target="${target.name}" />
		<antcall target="cleanup-postbuild" />
	</target>

	<target name="complete.code.analysis" description="Conducts an analysis of the code in this project as defined by the settings in the code-analysis project (available in SVN).">
		<antcall target = "compute.test.coverage"/>
		<antcall target="run.full.analysis"/>
	</target>

</project>